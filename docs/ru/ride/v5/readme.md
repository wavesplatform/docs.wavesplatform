# [Ride v5] Версия 5 Стандартной библиотеки

Версия 5 [Стандартной библиотеки](/ru/ride/script/standard-library) добавлена в версии ноды 1.3.0 и включается с активацией фичи №&nbsp;16 “Continuations”. Версии 1.3.x в настоящее время доступны только для [Stagenet](/ru/blockchain/blockchain-network/).

## Вызов dApp из dApp

Вызываемая функция dApp-скрипта может вызывать вызываемую функцию другого dApp или того же самого dApp, в том числе сама себя. Вызывающая функция может использовать значение, возвращаемое вызванной функцией. Последующие вычисления выполняются с учетом действий скрипта вызванной функции (как если бы они были применены к состоянию блокчейна). Все функции выполняются в рамках одной транзакции вызова скрипта. Общая сложность скриптов ограничена. [Подробнее о вызове dApp из dApp](/ru/ride/advanced/dapp-to-dapp)

Изменения в Ride:

* Добавлена встроенная функция [Invoke](/ru/ride/v5/functions/built-in-functions/dapp-to-dapp) для вызова dApp из dApp.
* Добавлены [нетерпеливые переменные](/ru/ride/variables/), которые вычисляются прежде следующего выражения, чтобы гарантировать порядок выполнения и применения действий скрипта вызываемых функций.
* Изменен [формат результата](/ru/ride/v5/functions/callable-function#результат-выполнения) вызываемой функции: добавлено возвращаемое значение.

## Вычисления с продолжением

Добавлена поддержка dApp-скриптов, сложность которых превышает 4000. Выполнение такого скрипта разбивается на несколько этапов: первый этап вычислений выполняется в рамках транзакции вызова скрипта, последующие этапы — в рамках транзакций продолжения. Транзакции продолжения создаются генераторами блоков автоматически. [Подробнее о вычислениях с продолжением](/ru/ride/advanced/continuation)

Добавлены встроенные [функции хранилища данных аккаунта](/ru/ride/v5/functions/built-in-functions/account-data-storage-functions), позволяющие dApp-скрипту читать записи из собственного хранилища данных на любом этапе вычислений:
* `getBinary(key: String): ByteVector|Unit`
* `getBinaryValue(key: String): ByteVector`
* `getBoolean(key: String): Boolean|Unit`
* `getBooleanValue(key: String): Boolean`
* `getInteger(key: String): Int|Unit`
* `getIntegerValue(key: String): Int`
* `getString(key: String): String|Unit`
* `getStringValue(key: String): String`

> Вычисления с продолжением и вызов dApp из dApp несовместимы, то есть не могут быть инициированы одной и той же транзакцией.

## Лизинг и отмена лизинга как действия скрипта

Добавлены действия скрипта, которые может выполнять вызываемая функция:
* [Lease](/ru/ride/v5/structures/script-actions/lease) — передает WAVES в лизинг.
* [LeaseCancel](/ru/ride/v5/structures/script-actions/lease-cancel) — прекращает лизинг.

C помощью действий `Lease` и `LeaseCancel` можно изменить сумму лизинга, в частности, извлечь часть средств из лизинга. Если в одном вызове скрипта отменить лизинг на большую сумму и создать новый лизинг на меньшую сумму с тем же получателем, генерирующий баланс получателя уменьшится на разницу. Если же отправить две отдельные транзакции — транзакцию отмены лизинга и транзакцию лизинга, генерирующий баланс сразу же уменьшится на сумму отмененного лизинга, а увеличится на сумму нового лизинга только через 1000 блоков.

Добавлена также встроенная функция [calculateLeaseId](/ru/ride/v5/functions/built-in-functions/blockchain-functions#calculateleaseid) для получения ID лизинга, сформированного структурой `Lease`.

## Подключение библиотек

Добавлена возможность создавать скрипты-библиотеки, содержащие определения функций и переменных, и подключать их в другие скрипты. При компиляции скрипта dApp, аккаунта или ассета, в котором есть подключенные библиотеки, в скомпилированный скрипт добавляются используемые функции и переменные библиотек. [Подробнее о подключении библиотек](/ru/ride/advanced/import)
