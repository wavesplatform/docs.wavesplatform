---
sidebarDepth: 2
---

# Конфигурация ноды

**Файл конфигурации** — это файл, в котором хранятся настройки ноды.

Конфигурация ноды Waves использует формат [HOCON](https://github.com/lightbend/config/blob/master/HOCON.md). Преимущества HOCON — это простой синтаксис и возможность использовать комментарии.

## Стандартные файлы конфигурации и ручные настройки

### Файл конфигурации, вложенный в JAR-файл

Пример стандартного файла конфигурации ноды, встроенного в JAR-файл: <https://github.com/wavesplatform/Waves/blob/master/node/src/main/resources/application.conf>.

> После обновления до версии 1.0.2 обратите внимание, что если ваш файл `/etc/waves/waves.conf` был изначально скопирован из шаблона, то следует убедиться, что параметр `waves.directory` задан верно. Если параметр не задан, то будет использоваться стандартный путь. Подробнее см. в подразделе [Настройки Waves](#настройки-waves) ниже.

### Изменение конфигурации JAR-ноды

Если нода установлена из JAR-файла, рекомендуется изменять настройки ноды, передавая путь к файлу конфигурации в параметре командной строки при запуске ноды. Замените `{*}` на реальное имя файла:

```bash
java -jar {*}.jar {*}.conf
```

Файл конфигурации должен содержать уникальные характеристики вашей ноды (IP-адрес, имя, ключи и т. д.), а также параметры сети блокчейна, аналогичные настройкам из файлов, поставляемых с DEB-пакетами (см. ниже).

### Файлы конфигурации Mainnet и Testnet в DEB-пакетах

Установочные DEB-пакеты содержат файлы конфигурации, которые переопределяют некоторые параметры, специфичные для сети:

* <https://github.com/wavesplatform/Waves/blob/master/node/waves-mainnet.conf>
* <https://github.com/wavesplatform/Waves/blob/master/node/waves-testnet.conf>
* <https://github.com/wavesplatform/Waves/blob/master/node/waves-stagenet.conf>

## Секции файла конфигурации

| Секция         | Описание                                                   |
|-----------------|---------------------------------------------------------------|
| [waves](#настройки-waves)| Основные параметры ноды и вложенные секции |
| &nbsp; &nbsp; &nbsp; db              | Параметры базы данных блокчейна |
| &nbsp; &nbsp; &nbsp; [network](#настройки-сети)| Параметры сети P2P |
| &nbsp; &nbsp; &nbsp; [wallet](#настройки-кошелька)| Параметры встроенного кошелька ноды |
| &nbsp; &nbsp; &nbsp; [blockchain](#настройки-блокчейна)| Параметры блокчейна |
| &nbsp; &nbsp; &nbsp; [miner](#настройки-генератора-блоков)| Параметры генератора блока |
| &nbsp; &nbsp; &nbsp; [rest-api](#настройки-rest-api)        | Параметры API ноды |
| &nbsp; &nbsp; &nbsp; [synchronization](#настройки-синхронизации) | Параметры синхронизации ноды |
| &nbsp; &nbsp; &nbsp; [utx](#настройки-utx-пула)| Параметры пула неподтвержденных транзакций |
| &nbsp; &nbsp; &nbsp; [features](#настройки-фич)        | Параметры фич |
| &nbsp; &nbsp; &nbsp; [rewards](#настройки-вознаграждения)| Параметры вознаграждений |
| &nbsp; &nbsp; &nbsp; extensions| Параметры расширений |
| kamon           | Параметры метрик производительности |
| metrics         | Блоки, транзакции и другие параметры метрик |

### Настройки Waves

Корневая секция `waves` содержит основные параметры ноды и вложенные секции.

С помощью параметра `directory` можно назначить путь к основной папке приложения. В настройках параметров конфигурации можно использовать переменные среды (environment variables). Пожалуйста, не заключайте переменные среды в кавычки: в этом случае они будут обработаны как строки и не будут применены.

Убедитесь, что для выбранной папки корректно указан владелец: `waves` для Mainnet и `waves-testnet` для Testnet.

#### Основная папка приложения по умолчанию

Следующие пути используются по умолчанию, если параметр `directory` не задан в файле конфигурации.

Для ноды, установленной из DEB-пакета:

| | *nix (DEB пакет) |
| :--- | :--- |
| Mainnet | `/var/lib/waves` |
| Testnet | `/var/lib/waves-testnet` |
| Stagenet| `/var/lib/waves-stagenet` |

Для ноды, установленной из JAR-файла:

| | *nix | macOS | Windows |
| :--- | :--- | :--- | :--- |
| Mainnet | `$XDG_DATA_HOME/waves-mainnet` или `$HOME/.local/share/waves-mainnet` | `$HOME/Library/Application Support/waves-mainnet` | `%LOCALAPPDATA%/waves-mainnet` |
| Testnet | `$XDG_DATA_HOME/waves-testnet` или `$HOME/.local/share/waves-testnet` | `$HOME/Library/Application Support/waves-testnet` | `%LOCALAPPDATA%/waves-testnet` |
| Stagenet | `$XDG_DATA_HOME/waves-stagenet` или `$HOME/.local/share/waves-stagenet` | `$HOME/Library/Application Support/waves-stagenet` | `%LOCALAPPDATA%/waves-stagenet` |
| Custom | `$XDG_DATA_HOME/waves-custom-<character>*` или `$HOME/.local/share/waves-custom-<character>*` | `$HOME/Library/Application Support/waves-custom-<character>*` | `%LOCALAPPDATA%/waves-custom-<character>*` |

\* См. описание параметра `address-scheme-character` в секции [Настройка собственного блокчейна](#custom).

Используйте параметр `leveldb-cache-size`, чтобы задать размер внутреннего кэша базы LevelDB.

**Примечание.** Необходимо указать количество байт для установки параметра размера кэша. Но вы можете использовать единицы измерения: <ul><li>K — килобайт</li><li>M — мегабайт</li><li>G — гигабайт</li></ul>

### Настройки сети

В секции `network` можно настроить параметры сети P2P.

| Имя | Описание | Значение по умолчанию |
|-----------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `file` | Путь базы данных, где нода хранит списки известных и занесенных в черный список peer-нод | По умолчанию путь формируется относительно основной папки приложения из секции `waves` |
| `declared-address` | Внешний IP-адрес и номер порта ноды. На большинстве облачных хостингов необходимо работать за NAT, и машина не взаимодействует напрямую с внешним адресом. Формат этого параметра: "\[ip-address\] :\[port\]" | Если вы не укажете его, то ваша нода подключится к сети P2P, но не будет прослушивать входящие подключения, поэтому другие ноды не смогут подключиться. Другие ноды подключаются к вашей ноде с использованием этих данных |
| `bind-address` | IP-адрес локального сетевого интерфейса, на котором нода будет принимать входящие соединения | По умолчанию нода привязана к `0.0.0.0`: это значит, что она будет принимать соединения на всех доступных сетевых адаптерах |
| `port` | Номер сетевого порта, к которому будут подключаться другие ноды Waves. Убедитесь, что порт доступен извне, иначе ваша нода будет подключаться к сети P2P только через исходящие соединения. Если этот порт занят другим приложением, ваша нода не запустится | |
| `node-name` | Имя вашей ноды, видимое для других участников P2P-сети. Передается во время первоначального рукопожатия (handshake) | По умолчанию этот параметр закомментирован, а имя ноды генерируется случайным образом |
| `nonce` | Значение, которое отправляется во время рукопожатия. Используется для различения нод, подключенных с одного IP-адреса | По умолчанию параметр не задан и значение генерируется случайным образом |
| `known-peers` | Список peer-нод, к которым ваша нода будет устанавливать исходящие соединения при инициализации | |
| `peers-data-residence-time` | Время, в течение которого нода хранит информацию о peer-ноде с момента последнего сеанса связи с ней | |
| `black-list-residence-time` | Время, в течение которого нода хранит информацию о peer-ноде, помещенной в черный список | |
| `max-inbound-connections` | Максимальное количество одновременных входящих соединений, обрабатываемых нодой | |
| `max-outbound-connections` | Максимальное количество исходящих сетевых подключений | |
| `max-single-host-connections` | Разрешенное количество сетевых подключений с&nbsp;одного IP-адреса | |
| `connection-timeout` | Таймаут сетевого соединения | |
| `outbound-buffer-size` | Размер сетевого буфера. Лучше оставить значение по умолчанию, неправильный размер буфера может привести к неисправности ноды | |
| `max-unverified-peers` | Максимальный размер буфера для хранения информации о peer-нодах во время процесса установления связи | |
| `enable-peers-exchange` | Включение/отключение запрашивания и отправки информации о peer-нодах | |
| `enable-blacklisting` | Включение/отключение черного списка peer-нод | |
| `peers-broadcast-interval` | Интервал между передачей списка известных peer-нод на другие ноды | |
| `handshake-timeout` | Время ожидания ответа при рукопожатии. В случае отсутствия ответа peer-нода будет занесена в черный список | |
| `upnp` | Параметры UPnP. Эти настройки полезны только в том случае, если вы запускаете свою ноду в домашней сети, где она может попросить маршрутизатор установить туннель. | По умолчанию эта функция отключена. Используйте значение `enable`, чтобы включить эту функцию |
| `traffic-logger` | Включение/отключение логирования некоторых входящих или исходящих сетевых сообщений. Сетевые сообщения регистрируются на уровне TRACE | |

**Примечание.** Все промежутки времени указываются в миллисекундах либо с использованием единиц измерения:
<ul><li>s — секунды</li><li>m — минуты</li><li>h — часы</li><li>d — дни</li></ul>
С примерами применения можно ознакомиться в стандартном конфигурационном файле выше.

### Настройки кошелька

В секции `wallet` можно настроить [кошелек ноды](/ru/waves-node/how-to-work-with-node-wallet).

| Имя | Описание | Значение по умолчанию |
|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------|
| `file` | Путь к файлу кошелька ноды | По умолчанию путь формируется относительно основной папки приложения |
| `password` | Пароль для защиты файла кошелька ноды | |
| `seed` | Секретная (seed) фраза в кодировке base58. Этот параметр используется для воссоздания существующего кошелька на новой ноде. Если у вас нет кошелька, закомментируйте этот параметр и запустите ноду. Во время первого запуска приложение создаст для вас новый кошелек со случайной секретной фразой. В этом случае секретная фраза будет отображаться в логе приложения. Если вы пропустили ее или не хотите проверять логи, секретную фразу можно получить с помощью метода `GET wallet/seed` Node REST API | |

**Warning:** Кошелек является важнейшей частью вашей ноды. Лучше создать его файл в безопасном и защищенном месте. Не забудьте сделать резервную копию файла кошелька. Рекомендуется удалить секретную фразу из файла конфигурации сразу после запуска ноды. Если злоумышленник получит доступ к секретной фразе, он получит доступ к вашим средствам по всем вашим адресам!

### Настройки блокчейна

В секции `blockchain` можно задать сеть блокчейна или настроить собственный (custom) блокчейн.

| Имя | Описание | Значение по умолчанию |
|---------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------|
| `max-transactions-per-block-diff` | Количество транзакций, которые будут храниться в памяти перед сохранением на диск. Уменьшение этого значения может увеличить количество операций записи на диск | |
| `min-blocks-in-memory` | Минимальное количество блоков, которые будут храниться в памяти | |
| `type` | Сеть блокчейна: TESTNET, MAINNET, STAGENET и CUSTOM. Для MAINNET, TESTNET и STAGENET параметры блокчейна встроены в приложение, поэтому дополнительная настройка не требуется. При выборе сети CUSTOM необходимо задать параметры секции `custom` | |

#### Настройка собственного (custom) блокчейна <a id="custom"></a>

Секция `custom` позволяет задать параметры [собственного блокчейна](/ru/waves-node/private-waves-network).

| Имя | Описание | Значение по умолчанию |
|--------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------|
| `address-scheme-character` | Символ, используемый при создании адреса, а также для передачи по сети во время рукопожатия, что позволяет нодам не подключаться к нодам из других сетей блокчейна | |
| `functionality` | Временные метки активации различных валидаций блокчейна. Лучше установить все настройки в 0 для активации всех валидаций | |
| `genesis` | Параметры блока генезиса | |
| `block-timestamp` | Дата и время создания блока генезиса | |
| `timestamp` | Дата и время создания транзакций генезиса |               |
| `signature` | Подпись блока генезиса |               |
| `initial-balance` | Первоначальное количество токенов. Это значение следует задавать в минимальных неделимых единицах криптовалюты | |
| `average-block-delay` | Скорость генерации блока в блокчейне. Это целевой период времени между блоками. На самом деле задержки между блоками могут варьироваться | |
| `transactions` | Список первых транзакций. Каждая транзакция содержит адрес получателя в кодировке base58 и количество токена. Весь начальный баланс нужно распределить по одному или нескольким адресам в блоке генезиса. Если вы этого не сделали, блок генезиса будет считаться некорректным и приложение не запустится | |

### Настройки генератора блоков

В секции `miner` можно задать параметры генератора блоков.

| Имя | Описание | Значение по умолчанию |
|------------------------------------------------------|-----------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `enable` | Включение/выключение генерации блоков. По умолчанию генерация включена, но если ее выключить, то нода не будет генерировать новые блоки |
| `quorum` | Минимальное количество подключенных peer-нод, необходимое для генерации новых блоков | По умолчанию задано значение 1. Это означает, что ваша нода начнет генерацию блоков, как только подключится к первой peer-ноде P2P-сети. Значение 0 включает офлайн-генерацию |
| `interval-after-last-block-then-generation-is-allowed` | Настройка загрузки и генерации блоков | По умолчанию задано значение 1 день. Это означает, что ваша нода не начнет генерацию, если последний блок локального блокчейна старше 1 дня. Используя данный параметр, вы даете команду ноде актуализировать блокчейн перед началом генерации новых блоков. Это применимо только после длительных отключений ноды |
| `no-quorum-mining-delay` | Задержка попыток генерации блоков, если кворум недоступен |
| `micro-block-interval` | Интервал между микроблоками |
| `max-transactions-in-micro-block` | Максимальное количество транзакций в микроблоке |
| `min-micro-block-age` | Генератор блока ссылается на лучший микроблок, который существует не менее указанного времени |
| `minimal-block-generation-offset` | Минимальный оффсет генерации блока |
| `max-pack-time` | Максимальное время packUnconfirmed |

### Настройки REST API

Секция `rest-api` файла конфигурации ноды содержит настройки [Node REST API](/ru/waves-node/node-api).

| # | Имя | Описание | Значение по умолчанию |
| :--- | :--- | :--- | :--- |
| 1 | `enable` | Активирует REST API. <br>Для деактивации REST API укажите значение `no` | `yes` |
| 2 | `bind-address` | Cетевой адрес, по которому REST API будет принимать входящие подключения. <br>**Примечание**. Не рекомендуется менять значение по умолчанию. Используйте [Nginx’s proxy pass module](http://nginx.org/ru/docs/http/ngx_http_proxy_module.html) или [SSH port forwarding](https://blog.trackets.com/2014/05/17/ssh-tunnel-local-and-remote-port-forwarding-explained-with-examples.html) для внешнего доступа. | `"127.0.0.1"` |
| 3 | `port` | Номер порта, через который REST API будет ожидать подключения. | `6869` |
| 4 | `api-key-hash` | Хеш [API-ключа](https://en.wikipedia.org/wiki/Application_programming_interface_key), который предоставляется владельцем ноды.<br>Как сгенерировать хеш API-ключа, читайте в подразделе [Генерация хеша API-ключа](#генерация-хеша-api-ключа) | "" |
| 5 | cors | Включение/выключение отправки кросс-доменных запросов CORS к ноде от JavaScript | yes |

**Примечание.** В запросах к Node REST API нужно указывать сам [API-ключ](https://en.wikipedia.org/wiki/Application_programming_interface_key), а не его хеш.

Пример подписания транзакции, отправляемой с кошелька ноды, с помощью команды curl:

```bash
curl -X POST --header 'Content-Type: application/json' --header 'Accept: application/json' --header 'X-API-Key: YOUR UNIQUE API KEY'
-d '{ \
"amount": 5800000000, \
"fee": 100000, \
"type": 4, \
"version": 1, \
"attachment": "", \
"sender": "3P3pUKEAKxegWr3PZkGYNq1mzQQaQ5zxZbw", \
"feeAssetId": null, \
"assetId": null, \
"recipient": "3P9p39MwZ5JjwdBSYEWC6XYri4jpovzcAbs", \
"feeAsset": null, \
"timestamp": 1568020044350 \
}' 'http://nodes.wavesnodes.com/transactions/sign'
```

#### Генерация хеша API-ключа

[API-ключ](https://en.wikipedia.org/wiki/Application_programming_interface_key) владельца ноды — это важнейший параметр, так же как и [секретная фраза](/en/blockchain/waves-protocol/cryptographic-practical-details#creating-a-private-key-from-a-seed) и пароль кошелька.<br>

Чтобы сгенерировать хеш API-ключа:

1. Перейдите в [Swagger web interface](/ru/waves-node/node-api).
2. Нажмите на секцию [`utils`](https://nodes.wavesnodes.com/api-docs/index.html#/utils).
3. Нажмите на метод [`/utils/hash/secure`](https://nodes.wavesnodes.com/api-docs/index.html#!/utils/hashSecure_1).
4. В параметре `message` укажите уникальный API-ключ как строку.
5. Получите хеш API-ключа и вставьте его в файл конфигурации ноды.
6. Перезапустите ноду.

**Внимание!** API-ключ передается в HTTP-заголовке в виде незащищенного текста. Злоумышленник может перехватить его при передаче по сети и использовать для перевода ваших средств на любой адрес. Очень важно защитить передачу данных с помощью переадресации портов HTTPS или SSH.

### Настройки синхронизации

В секции `synchronization` можно настроить различные параметры процесса синхронизации.

| Имя | Описание | Значение по умолчанию |
|--------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------|
| `max-rollback` | Количество блоков, которые будут сброшены в случае обнаружения форка. Если нода обнаружит форк с более низким `score`, она попытается переключиться на другой форк, для этого нода откатится на несколько блоков. Если обнаруженный форк длиннее заданного значения параметра, нода не будет переключаться, даже если `score` другого форка выше | |
| `max-chain-length` | Размер буфера для хранения блоков обнаруженного форка. Размер должен быть больше, чем максимальная длина форка | |
| `synchronization-timeout` | Таймаут операции загрузки блока | |
| `score-broadcast-interval` | Интервал между публикациями `score` в cети P2P | |
| `score-ttl` | Интервал `time-to-live` публикуемых пакетов `score` | |
| `remote-score-debounce` | Время ожидания получения следующего обновления данных `score` от других peer-нод | |
| `history-replier` | Во вложенной секции можно задать количество последних блоков и микроблоков, которые будут кешироваться в памяти | |
| `micro-block-synchronizer` | Во вложенной секции можно задать различные параметры протокола Waves-NG | |

### Настройки UTX-пула

В секции `utx` можно настроить параметры пула неподтвержденных транзакций.

| Имя | Описание | Значение по умолчанию |
|---------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------|
| `max-size` | Размер пула неподтвержденных транзакций (как скриптованных, так и нескриптованных) | |
| `max-scripted-size` | Размер пула неподтвержденных скриптованных транзакций. До версии ноды 1.1.6 транзакции вызова скрипта не учитывались (учитывались транзакции, для валидации которых требуется выполнить смарт-контракт) | |
| `max-transaction-age` | Задает максимальную давность транзакций. Более старые транзакции не будут допускаться в UTX-пул | |

### Настройки фич

Секция `features` задает параметры работы с [фичами](/ru/waves-node/features).

| Имя | Описание | Значение по умолчанию |
|--------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------|--------------------------------|
| `auto-shutdown-on-unsupported-feature` | Если этот параметр включен, нода будет остановлена при активации фичи, которая не поддерживается нодой | yes |
| `supported` | Список идентификаторов фич, поддерживаемых владельцем ноды | По умолчанию список пуст |

**Пример**:

```bash
 features {
   auto-shutdown-on-unsupported-feature = yes
   supported = []
 }
```

<a id="rewards"></a>

### Настройки вознаграждения

В данной секции вы можете указать желаемый размер вознаграждения за генерацию блоков в параметре `desired`. Значение указывается в [WAVELET](/ru/blockchain/token/wavelet).

Если значение больше текущего размера вознаграждения, то майнер голосует за увеличение вознаграждения; если меньше — за уменьшение.

**Пример**: желаемый размер вознаграждения 7 WAVES:

```js
waves {
  rewards {
    desired = 700000000
  }
}  
```

В качестве значения может быть указано любое целое число в диапазоне от 0 до 9 223 372 036 854 775 807 включительно.
Отрицательные значения игнорируются.

Подробнее см. в статье [Вознаграждение за майнинг](/ru/blockchain/mining/mining-reward).
